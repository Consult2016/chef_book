\newif\ifpdf
\ifx\pdfoutput\undefined
  \pdffalse
\else
  \ifnum\pdfoutput=1
    \pdftrue
  \else
    \pdffalse
  \fi
\fi

\ProvidesPackage{chef}

\RequirePackage{cmap}
\RequirePackage{graphicx}
\RequirePackage{tabularx}
\RequirePackage{indentfirst}
\RequirePackage{mathtext}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[english]{babel}
\RequirePackage{listings}
\RequirePackage[scaled]{beramono}
\RequirePackage{tgadventor}
\RequirePackage{times}
\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage[colorlinks=true]{hyperref}
\RequirePackage{amssymb,amsmath,amsfonts}
\RequirePackage{perpage} %the perpage package
\RequirePackage{wrapfig}
\RequirePackage{pdfpages} % cover image
\RequirePackage{lmodern}
\RequirePackage{xcolor}


\ifpdf
\RequirePackage{pdfpages} % cover image
\fi

\graphicspath{{images/}{cover/}}

\sloppy

\definecolor{lineno}{rgb}{0.5,0.5,0.5}
\definecolor{code}{rgb}{0,0.1,0.6}
\definecolor{keyword}{rgb}{0.5,0.1,0.1}
\definecolor{titlebox}{rgb}{0.85,0.85,0.85}
\definecolor{download}{rgb}{0.8,0.1,0.5}
\definecolor{code_title}{rgb}{0.8,0.1,0.4}
\definecolor{title}{rgb}{0.2,0.2,0.2}

\definecolor{codered}{rgb}{0.6,0,0} % for strings
\definecolor{codegreen}{rgb}{0.25,0.5,0.35} % comments
\definecolor{codepurple}{rgb}{0.5,0,0.35} % keywords
\definecolor{codedocblue}{rgb}{0.25,0.35,0.75} % javadoc

\lstset{
  language=Ruby,
  basicstyle=\ttfamily,
  keywordstyle=\color{codepurple}\bfseries,
  stringstyle=\color{codered},
  commentstyle=\color{codegreen},
  showspaces=false,
  showstringspaces=false,
  breaklines=true,
  breakatwhitespace=true,
  numbers=left,
  firstnumber=1,
  stepnumber=5,
  numberfirstline=true,
  numberstyle=\color{lineno}\sffamily\scriptsize,
  keywordstyle=\color{keyword}\bfseries
}

\colorlet{punct}{red!60!black}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{JSON}{
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\makeatletter
\gdef\lst@SkipOrPrintLabel{%
    \ifnum\lst@skipnumbers=\z@
        \global\advance\lst@skipnumbers-\lst@stepnumber\relax
        \lst@PlaceNumber
        \lst@numberfirstlinefalse
    \else
        \lst@ifnumberfirstline
            {\def\thelstnumber{Line \@arabic\c@lstnumber}\lst@PlaceNumber}%
            \lst@numberfirstlinefalse
        \else
            {\def\thelstnumber{-}\lst@PlaceNumber}%
        \fi
    \fi
    \global\advance\lst@skipnumbers\@ne}%
\def\lst@maketitle#1{
   \vskip\abovecaptionskip
   \colorbox{titlebox}{
       %\scriptsize
       \small
       \color{download}\ttfamily\href{http://chef.leopard.in.ua/code/#1}{Download}
       \color{title}\sffamily\bfseries#1}
   \vskip\belowcaptionskip}
\def\lst@makecaption#1#2{
  \vskip\abovecaptionskip
  \colorbox{titlebox}{
      %\scriptsize
      \small
      \color{code_title}\ttfamily#1
      \color{title}\sffamily\bfseries#2}
  \vskip\belowcaptionskip}
\makeatother

\let\olditemize=\itemize
\def\itemize{
  \olditemize
  \setlength{\itemsep}{-1ex}
}

\let\oldenumerate=\enumerate
\def\enumerate{
  \oldenumerate
  \setlength{\itemsep}{-1ex}
}

\MakePerPage{footnote} %the perpage package command